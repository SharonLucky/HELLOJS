<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<ul id="test">
    <li>这是第一条</li>
    <li>这是第二条</li>
    <li>这是第三条</li>
</ul>
<script>
    /*Q1:请写出以下输出结果:JavaScript的综合能力，包含了变量定义提升、this指针指向、运算符优先级、原型、继承、全局变量污染、对象属性及原型属性优先级等知识 */
    function Foo() {
        getName = function () { alert (1); };
        return this;
    }
    Foo.getName = function () { alert (2);};
    Foo.prototype.getName = function () { alert (3);};
    var getName = function () { alert (4);};
    function getName() { alert (5);}

    //请写出以下输出结果：
    Foo.getName();//2
    getName();//函数声明和函数表达式+变量提升 =>4
    Foo().getName();//1
    getName();//Foo执行后把全局的getName函数给重写了一次 => 1
    new Foo.getName();//JS的运算符优先级问题，相当于new (Foo.getName)()=> 弹出2；
    new Foo().getName();//(new Foo()).getName() =>3
    new new Foo().getName();//new ((new Foo()).getName)();=>3

    //先看一个基础例子
    function User(name) {
        var name = name; //私有属性
        this.name = name; //公有属性
        function getName() { //私有方法
            return name;
        }
    }
    User.prototype.getName = function() { //公有方法
        return this.name;
    }
    User.name = 'Wscats'; //静态属性
    User.getName = function() { //静态方法
        return this.name;
    }
    var Wscat = new User('Wscats'); //实例化
    /*注意下面这几点：
     1- 调用公有方法，公有属性，我们必需先实例化对象，也就是用new操作符实化对象，就可构造函数实例化对象的方法和属性，并且公有方法是不能调用私有方法和静态方法的
     2- 静态方法和静态属性就是我们无需实例化就可以调用
     3- 而对象的私有方法和属性,外部是不可以访问的*/

    /*----------------------------------------------------------------*/

    /*Q2:为 Array 对象添加一个去除重复项的方法 */

    Array.prototype.uniq = function () {
        var arr = [];
        var flag = true;
        this.forEach(function(item) {
            // 排除 NaN (重要！！！)
            if (item != item) {
                flag && arr.indexOf(item) === -1 ? arr.push(item) : '';
                flag = false;
            } else {
                arr.indexOf(item) === -1 ? arr.push(item) : ''
            }
        });
        return arr;
    }
    //[false, true, undefined, null, NaN, 0, 1, {}, {}, 'a', 'a', NaN].uniq();//验证[false, true, undefined, null, NaN, 0, 1, {}, {}, 'a']

    /*----------------------------------------------------------------*/

    /*Q3: js如何判断一个数组:用Array.isArray IE9以下不行*/
    if(Object.prototype.toString.call('[1,3,4]')==='[Object Array]'){
        alert("array")
    }
    /*----------------------------------------------------------------*/

    /*Q4: 下面这个ul，如何点击每一列的时候alert其index?（闭包）*/
    /*<ul id=”test”>
     <li>这是第一条</li>
     <li>这是第二条</li>
     <li>这是第三条</li>
     </ul>
     */
    var list=document.getElementById("test").getElementsByTagName("li");
    for(var i=0;i<list.length;i++){//方法一
        list[i].index=i;
        list[i].onclick=function () {
            alert(this.index)
        }
    }
    for(var i=0;i<list.length;i++){//方法二
        list[i].index=i;
        list[i].onclick=function (a) {
            return function () {
                alert(a)
            }
        }(i)
    }
    
    /*----------------------------------------------------------------*/
    /*Q5:定义一个log方法，让它可以代理console.log的方法。调用log的方式，传入多个参数*/
    function log(){
        console.log.apply(console,arguments)
    };
    log("hello","lucky")
    //给每一个log消息添加一个"(app)"的前辍
    function log() {
        var args=Array.prototype.slice.call(arguments)
        args.unshift('(app)');
        console.log.apply(console,args)
    }
    log("hello","lucky")


    /*----------------------------------------------------------------*/
    /*Q6:上下文和this的理解*/
    var User = {
        count: 1,

        getCount: function() {
            return this.count;
        }
    };
    console.log(User.getCount());//1

    var func = User.getCount;
    console.log(func());//undefined

    //解决方法：
    var func = User.getCount.bind(User);
    console.log(func());//1。

    //bind 对老版本的浏览器不起作用的解决办法：
    Function.prototype.bind=Function.prototype.bind||function (context) {
                var self=this;
                return function () {
                    return self.apply(context,arguments)
                }
            }

    /*----------------------------------------------------------------*/
    /*Q7: 如何用原生JS实现Jq的ready方法*/
    function ready(fn){
        if(document.addEventListener) {        //标准浏览器
            document.addEventListener('DOMContentLoaded', function() {
                //注销事件, 避免反复触发
                document.removeEventListener('DOMContentLoaded',arguments.callee, false);
                fn();            //执行函数
            }, false);
        }else if(document.attachEvent) {        //IE
            document.attachEvent('onreadystatechange', function() {
                if(document.readyState == 'complete') {
                    document.detachEvent('onreadystatechange', arguments.callee);
                    fn();        //函数执行
                }
            });
        }
    };

    /*----------------------------------------------------------------*/
    /*Q8: 用户进来时显示，同一天访问不显示tip提醒 + 当用户点击我知道了，此后访问该页面不再显示tip提醒*/
    function setcookie(name,value,days){  //给cookie增加一个时间变量
        var exp = new Date();
        exp.setTime(exp.getTime() + days*24*60*60*1000); //设置过期时间为days天
        document.cookie = name + "="+ escape (value) + ";expires=" + exp.toGMTString();
    }
    function getCookie(name){
        var result = "";
        var myCookie = ""+document.cookie+";";
        var searchName = ""+name+"=";
        var startOfCookie = myCookie.indexOf(searchName);
        var endOfCookie;
        if(satrtOfCookie != -1){
            startOfcookie += searchName.length;
            endOfCookie = myCookie.indexOf(";",startOfCookie);
            result = (myCookie.substring(startOfCookie,endOfCookie));
        }
        return result;
    }
    (function(){
        var oTips = document.getElementById('tips');//假设tips的id为tips
        var page = {
            check: function(){//检查tips的cookie是否存在并且允许显示
                var tips = getCookie('tips');
                if(!tips || tips == 'show') return true;//tips的cookie不存在
                if(tips == "never_show_again") return false;
            },
            hideTip: function(bNever){
                if(bNever) setcookie('tips', 'never_show_again', 365);
                oTips.style.display = "none";//隐藏
            },
            showTip: function(){
                oTips.style.display = "inline";//显示，假设tips为行级元素
            },
            init: function(){
                var _this = this;
                if(this.check()){
                    _this.showTip();
                    setcookie('tips', 'show', 1);
                }
                oTips.onclick = function(){
                    _this.hideTip(true);
                };
            }
        };
        page.init();
    })();

    /*----------------------------------------------------------------*/
    /*Q9:下面这个JS程序的输出是什么*/

    function Foo() {
        var i = 0;
        return function() {
            console.log(i++);
        }
    }
    var f1 = Foo(),
        f2 = Foo();
    f1();//0
    f1();//1
    f2();//0


    (function() {
        var a = b = 5;
    })();
    console.log(b);//5
    console.log(a);//undefined


    var f = function g(){ return 23; };
    typeof g();//会发生错误ReferenceError: g is not defined,因为function g(){ return 23; }是函数表达式,事实上只有事一个名字,不是一个函数声明,函数实际上是绑定到变量f，不是g。


    var x = 1;
    if (function f(){} ){
        x += typeof f;
    }
    console.log(x);//1undefined


    /*考察this(测试环境是浏览器，Node环境中全局对象有所不同)*/
    var length = 10;
    function fn() {
        console.log(this.length);
    }
    var obj = {
        length: 5,
        method: function(fn) {
            fn();
            arguments[0]();//执行arguments[0]的时候 this上下文已经变成arguments
        }
    };
    obj.method(fn, 1);//10  2

    /*----------------------------------------------------------------*/
    /*Q10:var和函数的声明提前：函数声明就能覆盖变量声明*/
    function fn(a) {
        console.log(a);
          var a = 2;//①
          function a() {}//②
        console.log(a);
    }
    fn(1); // function a() {} 2 //chrome测试

    /*----------------------------------------------------------------*/
    /*Q11:给基本类型数据添加属性，不报错，但取值时是undefined*/
    var a = 10;
    a.pro = 10;
    console.log(a.pro + a);//NaN
    var s = 'hello';
    s.pro = 'world';
    console.log(s.pro + s);//undefinedhello

    var num1=5;
    var num2=num1;
    num1=7
    console.log(num1)
    /*----------------------------------------------------------------*/
    /*Q12*/

</script>
</body>
</html>